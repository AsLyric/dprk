---
title: 树链剖分好题（一）
published: 2025-09-20
updated: 2025-09-20
tags: [树上问题, 树链剖分, 题集]
category: 信息学
draft: false
---

# 树链剖分

## 重链剖分

#### CF704E Iron Man

非常好的一道树链剖分题。

转化为二维平面上若干条线段，求时间最小的交点。 

但是交点可能有 $m^2$ 个。 

我们只考虑每条线段 $x$ 在加入时，和它相邻的两条线段的交点，更新答案。

因为如果 $x$ 不是和加入时和它相邻的最早相交，而是和 $y$，那么 $y$ 一定和 $y$ 相邻的某一条 $z$ 更早相交（也就是 $x,y$ 的交点不会影响答案）。

这里假定了 $x,y$ 之间的线段都没有被删除，我们再加一个删除线段时用它相邻两条的交点更新答案就好了。

#### P4719 【模板】动态 DP

题意为求最大点权独立集的点权和，但需要支持修改点权。

dp 拆成和重儿子有关的、和重儿子无关的部分。

设 $f_{u,0/1}$ 为 $u$ 子树内选/不选 $u$ 的最大答案，$g_{u,0/1}$ 为子树内除重儿子 $v$ 外，选/不选 $u$ 的最大答案。

$$
f_{u,0}=g_{u,0}+\max(f_{v,0},f_{v,1})\\
f_{u,1}=g_{u,1}+f_{v,0}
$$

构造成乘上一个系数矩阵乘上重儿子的矩阵的形式（$(+,\max)$ 广义矩阵乘法）：

$$
\begin{bmatrix}
g_{u,0} & g_{u,0}\\
g_{u,1} & -\inf
\end{bmatrix}
\begin{bmatrix}
f_{v,0}\\
f_{v,1}
\end{bmatrix}
$$

$g$ 我们初始时正常 DP 转移，然后在每个轻边暴力修改父亲的系数矩阵，然后 $f$ 为当前节点到这条链尾的矩阵的乘积。